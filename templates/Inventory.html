{% extends "base.html" %}

{% block title %}Inventory{% endblock %}

{% block content %}

<style>
/* ====================================================================
   BASE STYLES & BACKGROUND
   ==================================================================== */

/* Set background to pure black for entire page */
html, body {
    background: #000000;
    margin: 0;
    padding: 0;
    overflow-x: hidden; /* Prevent horizontal scroll */
}

/* Set font family and text color for body */
body {
    font-family: 'Inter', -apple-system, sans-serif;
    color: #fff;
}

/* ====================================================================
   PAGE WRAPPER
   ==================================================================== */

/* Main page wrapper - ensures content doesn't touch top/bottom edges */
.page-wrap {
    min-height: 100vh; /* Full viewport height */
    padding-top: 100px; /* Space for fixed navbar */
    padding-bottom: 60px; /* Bottom spacing */
    position: relative;
    background: #000000;
}

/* Fixed background layer behind all content */
.page-wrap::before {
    content: "";
    position: fixed;
    inset: 0; /* Shorthand for top/right/bottom/left: 0 */
    background: #000000;
    z-index: 0; /* Behind content */
}

/* Ensure all direct children of page-wrap are above background */
.page-wrap > * { 
    position: relative; 
    z-index: 1; 
}

/* ====================================================================
   HERO SECTION (Page Header)
   ==================================================================== */

/* Glass-effect hero banner at top of page */
.hero {
    max-width: 1200px;
    margin: 0 auto 30px; /* Center horizontally, add bottom margin */
    padding: 30px 20px;
    background: rgba(255, 255, 255, 0.08); /* Semi-transparent white */
    backdrop-filter: blur(20px); /* Blur background for glass effect */
    border-radius: 24px;
    border: 1px solid rgba(255, 255, 255, 0.15); /* Subtle border */
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.30); /* Drop shadow */
    position: relative;
    overflow: hidden;
}

/* Background image layer for hero (currently not used in markup) */
.hero-bg {
    position: absolute;
    inset: 0;
    background-image:
        linear-gradient(
            180deg,
            rgba(0,0,0,0.60) 0%,
            rgba(0,0,0,0.40) 45%,
            rgba(0,0,0,0.75) 100%
        ),
        url("{{ url_for('static', filename='preview.jpg') }}");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* Main title in hero section */
.hero h1 {
    margin: 0 0 10px;
    font-weight: 900;
    font-size: 3.5rem;
    letter-spacing: -0.03em; /* Tighter letter spacing */
    text-shadow: 0 2px 20px rgba(0,0,0,0.3);
    /* Gradient text effect */
    background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Subtitle text in hero */
.hero p {
    margin: 0;
    color: rgba(255,255,255,0.85);
    font-size: 1.2rem;
}

/* ====================================================================
   MAIN CONTAINER
   ==================================================================== */

/* Container for all content panels */
.card-shell {
    max-width: 1200px;
    margin: 0 auto; /* Center horizontally */
    padding: 0 20px; /* Side padding */
}

/* ====================================================================
   PANELS (Content Sections)
   ==================================================================== */

/* Dark glass panels for each major section */
.panel {
    background: rgba(255, 255, 255, 0.08); /* Semi-transparent white */
    backdrop-filter: blur(18px); /* Glass effect */
    border-radius: 24px;
    box-shadow: 0 18px 60px rgba(0,0,0,0.35);
    padding: 30px;
    border: 1px solid rgba(255,255,255,0.14);
    margin-bottom: 24px;
    color: rgba(255,255,255,0.92);
}

/* ====================================================================
   SECTION TITLES
   ==================================================================== */

/* Title for each panel section */
.section-title {
    font-size: 1.4rem;
    font-weight: 800;
    color: rgba(255,255,255,0.92);
    margin: 0 0 16px;
    display: flex;
    align-items: center;
    gap: 10px; /* Space between bar and text */
}

/* Decorative bar before section title */
.section-title::before {
    content: "";
    width: 4px;
    height: 24px;
    background: rgba(255,255,255,0.85);
    border-radius: 2px;
}

/* ====================================================================
   CONTROLS (Search, Sort, Filter)
   ==================================================================== */

/* Grid layout for control inputs */
.controls {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto; /* Search wider, button auto */
    gap: 14px;
    align-items: end; /* Align items to bottom */
    margin-bottom: 0;
    flex-wrap: initial;
}

/* Responsive: stack controls on smaller screens */
@media (max-width: 1000px) {
    .controls { grid-template-columns: 1fr 1fr; }
}

/* Style for all input and select elements in controls */
.controls input,
.controls select {
    width: 100%;
    box-sizing: border-box;
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.35); /* Dark input background */
    color: rgba(255,255,255,0.92);
    font-size: 1rem;
    transition: all 0.25s ease; /* Smooth transitions */
}

/* Focus state for inputs */
.controls input:focus,
.controls select:focus {
    border-color: rgba(255,255,255,0.35);
    box-shadow: 0 0 0 4px rgba(255,255,255,0.08); /* Focus ring */
    outline: none;
}

/* Button styling in controls */
.controls button {
    padding: 12px 22px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 800;
    background: rgba(255,255,255,0.92); /* Light button on dark background */
    color: #111827; /* Dark text */
    font-size: 1rem;
    transition: all 0.25s ease;
    box-shadow: 0 10px 26px rgba(0,0,0,0.28);
}

/* Hover effect for buttons */
.controls button:hover {
    transform: translateY(-2px); /* Lift on hover */
    box-shadow: 0 16px 45px rgba(0,0,0,0.35);
    background: #ffffff;
}

/* ====================================================================
   STATISTICS BAR (KPI Cards)
   ==================================================================== */

/* Container for stat cards */
.stats-bar {
    background: transparent;
    border: none;
    padding: 0;
    margin-bottom: 0;
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 equal columns */
    gap: 16px;
    flex-wrap: initial;
}

/* Responsive: 2 columns on smaller screens */
@media (max-width: 1000px) {
    .stats-bar { grid-template-columns: repeat(2, 1fr); }
}

/* Individual stat card (KPI) */
.stat-item {
    background: rgba(255,255,255,0.92); /* Light card */
    color: #111827; /* Dark text */
    border-radius: 20px;
    padding: 22px 24px;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.25);
    transition: all 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy animation */
    min-width: 0; /* Allow flex shrinking */
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

/* Animated gradient overlay on stat cards */
.stat-item::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0,0,0,0.08) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.35s ease;
}

/* Show gradient on hover */
.stat-item:hover::before { opacity: 1; }

/* Hover effect for stat cards */
.stat-item:hover {
    transform: translateY(-8px) scale(1.02); /* Lift and slightly enlarge */
    box-shadow: 0 16px 45px rgba(0,0,0,0.35);
    border-color: rgba(255,255,255,0.35);
}

/* Label text in stat card (e.g., "Total Products") */
.stat-label {
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    color: rgba(17,24,39,0.65);
    text-transform: uppercase;
    font-weight: 700;
}

/* Value text in stat card (e.g., "150") */
.stat-value {
    margin-top: 8px;
    font-size: 1.8rem;
    font-weight: 900;
    color: #111827;
    background: none;
    -webkit-text-fill-color: initial;
}

/* Keep specific colors for warning/critical states */
.stat-value[style*="#f59e0b"] { 
    color: #f59e0b !important; 
    -webkit-text-fill-color: #f59e0b !important; 
}
.stat-value[style*="#dc3545"] { 
    color: #ef4444 !important; 
    -webkit-text-fill-color: #ef4444 !important; 
}

/* ====================================================================
   PRODUCT GRID
   ==================================================================== */

/* Grid layout for product cards */
.grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 columns */
    gap: 18px;
}

/* Responsive breakpoints for grid */
@media (max-width: 1100px) {
    .grid { grid-template-columns: repeat(2, 1fr); } /* 2 columns */
}
@media (max-width: 600px) {
    .grid { grid-template-columns: 1fr; } /* 1 column */
}

/* ====================================================================
   PRODUCT CARDS
   ==================================================================== */

/* Individual product card */
.card {
    background: rgba(0,0,0,0.22); /* Dark card on dark background */
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.14);
    transition: all 0.25s ease;
    position: relative;
    color: rgba(255,255,255,0.92);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    min-width: 0;
}

/* Hover effect for product cards */
.card:hover {
    transform: translateY(-4px); /* Lift on hover */
    box-shadow: 0 16px 45px rgba(0,0,0,0.35);
    border-color: rgba(255,255,255,0.28);
}

/* Image placeholder in product card */
.img-placeholder {
    background: rgba(255,255,255,0.06); /* Very dark placeholder */
    height: 160px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255,255,255,0.6);
    margin-bottom: 10px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.14);
}

/* Stock status text */
.stock {
    font-size: 13px;
    margin-top: 8px;
    color: rgba(255,255,255,0.75);
}

/* Stock level indicators (colors maintained for visibility) */
.low { 
    color: #f59e0b; /* Yellow for low stock */
    font-weight: 800; 
}
.critical { 
    color: #ef4444; /* Red for critical stock */
    font-weight: 900; 
}

/* ====================================================================
   CARD ACTIONS (Edit/Delete Buttons)
   ==================================================================== */

/* Container for action buttons in card */
.card-actions {
    display: flex;
    gap: 10px;
    margin-top: 12px;
}

/* Base styling for action buttons */
.card-actions button {
    flex: 1; /* Equal width */
    padding: 10px 12px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 800;
    transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
}

/* Hover effect for action buttons */
.card-actions button:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.15);
}

/* Edit button styling */
.edit-btn {
    background: rgba(255,255,255,0.92);
    color: #111827;
}

/* Delete button styling */
.delete-btn {
    background: #ef4444; /* Red background */
    color: white;
}

/* ====================================================================
   LOADING & EMPTY STATES
   ==================================================================== */

/* Loading/empty state message */
.loading {
    text-align: center;
    padding: 50px;
    font-size: 18px;
    color: rgba(255,255,255,0.65);
}

/* ====================================================================
   PAGINATION CONTROLS
   ==================================================================== */

/* Pagination container */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 22px;
    padding: 0;
}

/* Pagination buttons */
.pagination button {
    padding: 0.55rem 1rem;
    background: rgba(255,255,255,0.10);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 12px;
    color: rgba(255,255,255,0.92);
    cursor: pointer;
    font-weight: 800;
    transition: all 0.2s;
}

/* Hover state for pagination buttons */
.pagination button:hover:not(:disabled) {
    border-color: rgba(255,255,255,0.28);
    transform: translateY(-1px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.16);
}

/* Disabled state for pagination buttons */
.pagination button:disabled {
    opacity: 0.35;
    cursor: not-allowed;
}

/* Page info text (e.g., "of 5") */
.pagination .page-info {
    color: rgba(255,255,255,0.65);
    font-size: 14px;
    font-weight: 700;
}

/* Current page number display */
.pagination .page-number {
    padding: 0.55rem 1rem;
    background: rgba(255,255,255,0.92);
    border: 1px solid rgba(255,255,255,0.92);
    border-radius: 12px;
    color: #111827;
    font-weight: 900;
}

/* ====================================================================
   MODAL STYLES (Add/Edit Product)
   ==================================================================== */

/* Modal overlay */
.modal {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0; 
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.75); /* Dark overlay */
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

/* Show modal when active class is added */
.modal.active { display: flex; }

/* Modal content box */
.modal-content {
    background: rgba(15, 15, 15, 0.92); /* Very dark background */
    padding: 25px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.14);
    width: 90%;
    max-width: 520px;
    max-height: 90vh;
    overflow-y: auto; /* Scrollable if content is too tall */
    box-shadow: 0 20px 80px rgba(0,0,0,0.35);
    color: rgba(255,255,255,0.92);
}

/* Modal title */
.modal-content h2 {
    margin-top: 0;
    margin-bottom: 18px;
    font-weight: 900;
}

/* Form labels in modal */
.modal-content label {
    display: block;
    margin-bottom: 8px;
    font-size: 0.85rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: rgba(255,255,255,0.75);
}

/* Form inputs in modal */
.modal-content input,
.modal-content select {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 14px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.35); /* Dark input background */
    color: rgba(255,255,255,0.92);
    box-sizing: border-box;
    transition: all 0.25s ease;
}

/* Focus state for modal inputs */
.modal-content input:focus,
.modal-content select:focus {
    border-color: rgba(255,255,255,0.35);
    box-shadow: 0 0 0 4px rgba(255,255,255,0.08);
    outline: none;
}

/* Error state for inputs */
.modal-content input.error,
.modal-content select.error {
    border-color: #ef4444; /* Red border for errors */
}

/* Error message styling */
.error-message {
    color: #ef4444;
    font-size: 12px;
    margin-top: -10px;
    margin-bottom: 10px;
    display: none; /* Hidden by default */
    font-weight: 700;
}

/* Show error message when class is added */
.error-message.show { display: block; }

/* Modal action buttons container */
.modal-actions {
    display: flex;
    gap: 12px;
    margin-top: 10px;
}

/* Base styling for modal action buttons */
.modal-actions button {
    flex: 1;
    padding: 12px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 900;
    transition: all 0.2s;
}

/* Save button styling */
.save-btn {
    background: rgba(255,255,255,0.92);
    color: #111827;
    box-shadow: 0 10px 26px rgba(0,0,0,0.28);
}

/* Save button hover effect */
.save-btn:hover { 
    transform: translateY(-1px); 
    box-shadow: 0 16px 45px rgba(0,0,0,0.35); 
}

/* Disabled save button */
.save-btn:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    box-shadow: none;
}

/* Cancel button styling */
.cancel-btn {
    background: rgba(255,255,255,0.18);
    color: rgba(255,255,255,0.92);
    border: 1px solid rgba(255,255,255,0.22);
    opacity: 1;
}

/* Cancel button hover effect */
.cancel-btn:hover { 
    background: rgba(255,255,255,0.24); 
    transform: translateY(-1px); 
}

/* ====================================================================
   BIG NOTIFICATION (Success/Error Messages)
   ==================================================================== */

/* Large animated notification overlay */
.big-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0); /* Start hidden and scaled down */
    background: linear-gradient(135deg, #ef4444 0%, #ff6b6b 100%); /* Red gradient for errors */
    color: white;
    padding: 50px 70px;
    border-radius: 25px;
    font-size: 48px;
    font-weight: 900;
    text-align: center;
    z-index: 10000; /* Above everything */
    box-shadow: 0 20px 60px rgba(239, 68, 68, 0.45);
    border: 4px solid #fff;
    opacity: 0;
    pointer-events: none; /* Don't block clicks */
}

/* Success variant (green gradient) */
.big-notification.success {
    background: linear-gradient(135deg, #10b981 0%, #5cb85c 100%);
    box-shadow: 0 20px 60px rgba(16, 185, 129, 0.45);
}

/* Show animation */
.big-notification.show {
    animation: bigPopIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
}

/* Hide animation */
.big-notification.hide {
    animation: bigPopOut 0.4s ease-in forwards;
}

/* Pop-in animation keyframes */
@keyframes bigPopIn {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.1); } /* Overshoot */
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

/* Pop-out animation keyframes */
@keyframes bigPopOut {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
}

/* Icon in notification (‚úì or ‚úñ) */
.notification-icon {
    font-size: 80px;
    display: block;
    margin-bottom: 20px;
}

/* ====================================================================
   DELETE CONFIRMATION MODAL
   ==================================================================== */

/* Delete confirmation modal overlay */
.delete-modal {
    display: none;
    position: fixed;
    top: 0; 
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.80); /* Darker overlay */
    z-index: 2000; /* Above regular modal */
    align-items: center;
    justify-content: center;
}

/* Show delete modal */
.delete-modal.active { display: flex; }

/* Delete modal content */
.delete-modal-content {
    background: rgba(15, 15, 15, 0.92);
    padding: 26px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.14);
    max-width: 480px;
    width: 92%;
    text-align: center;
    box-shadow: 0 20px 80px rgba(0,0,0,0.35);
    color: rgba(255,255,255,0.92);
}

/* Delete modal title */
.delete-modal-content h3 {
    color: #ef4444; /* Red for warning */
    font-size: 1.35rem;
    margin-bottom: 10px;
    font-weight: 900;
}

/* Delete modal description text */
.delete-modal-content p {
    color: rgba(255,255,255,0.75);
    margin-bottom: 18px;
    line-height: 1.6;
}

/* Delete modal action buttons container */
.delete-modal-actions {
    display: flex;
    gap: 12px;
}

/* Delete modal buttons */
.delete-modal-actions button {
    flex: 1;
    padding: 12px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 900;
    font-size: 14px;
}
</style>

<!-- ====================================================================
     HTML MARKUP
     ==================================================================== -->

<div class="page-wrap">
    <!-- ================================================================
         HERO SECTION (Page Header)
         ================================================================ -->
    <div class="hero">
        <h1>Inventory</h1>
        <p>Stock overview, product management, and low-stock visibility</p>
    </div>

    <div class="card-shell">
        <!-- ============================================================
             KPI PANEL (Statistics Overview)
             ============================================================ -->
        <div class="panel">
            <h2 class="section-title">Inventory Overview</h2>

            <!-- Stats bar with 4 KPI cards -->
            <div class="stats-bar">
                <!-- Total Products KPI -->
                <div class="stat-item">
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="totalProducts">0</div>
                </div>
                
                <!-- Total Stock KPI -->
                <div class="stat-item">
                    <div class="stat-label">Total Stock</div>
                    <div class="stat-value" id="totalStock">0</div>
                </div>
                
                <!-- Low Stock Items KPI (Yellow) -->
                <div class="stat-item">
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-value" style="color: #f59e0b;" id="lowStockItems">0</div>
                </div>
                
                <!-- Critical Stock Items KPI (Red) -->
                <div class="stat-item">
                    <div class="stat-label">Critical Stock</div>
                    <div class="stat-value" style="color: #dc3545;" id="criticalStockItems">0</div>
                </div>
            </div>
        </div>

        <!-- ============================================================
             CONTROLS PANEL (Search, Sort, Pagination, Add Button)
             ============================================================ -->
        <div class="panel">
            <h2 class="section-title">Controls</h2>

            <div class="controls">
                <!-- Search input -->
                <input type="text" id="searchInput" placeholder="Search products...">
                
                <!-- Sort dropdown -->
                <select id="sortSelect">
                    <option value="">Sort by</option>
                    <option value="name">Name (A‚ÄìZ)</option>
                    <option value="stock">Stock (High ‚Üí Low)</option>
                    <option value="price">Price (Low ‚Üí High)</option>
                </select>
                
                <!-- Items per page selector -->
                <select id="perPageSelect">
                    <option value="12">12 per page</option>
                    <option value="24" selected>24 per page</option>
                    <option value="48">48 per page</option>
                    <option value="96">96 per page</option>
                </select>
                
                <!-- Add product button -->
                <button id="addProductBtn">+ Add Product</button>
            </div>
        </div>

        <!-- ============================================================
             PRODUCTS PANEL (Product Grid Display)
             ============================================================ -->
        <div class="panel">
            <h2 class="section-title">Products</h2>

            <!-- Product grid (populated by JavaScript) -->
            <div class="grid" id="productGrid">
                <div class="loading">Loading inventory...</div>
            </div>

            <!-- Pagination controls (hidden until products load) -->
            <div class="pagination" id="paginationControls" style="display: none; margin-top: 22px;">
                <button id="firstPageBtn">First</button>
                <button id="prevPageBtn">Prev</button>
                <span class="page-number" id="currentPageDisplay">1</span>
                <span class="page-info" id="pageInfo">of 1</span>
                <button id="nextPageBtn">Next</button>
                <button id="lastPageBtn">Last</button>
            </div>
        </div>
    </div>
</div>

<!-- ====================================================================
     MODAL FOR ADD/EDIT PRODUCT
     ==================================================================== -->
<div class="modal" id="productModal">
    <div class="modal-content">
        <h2 id="modalTitle">Add Product</h2>
        <form id="productForm">
            <!-- Supplier Part Number (optional) -->
            <label for="productPartNo">Supplier Part Number</label>
            <input type="text" id="productPartNo" placeholder="e.g., SP-12345">
            <div class="error-message" id="errorPartNo"></div>

            <!-- Product Name (required, min 3 chars) -->
            <label for="productName">Product Name * (Min 3 chars)</label>
            <input type="text" id="productName" required minlength="3">
            <div class="error-message" id="errorName"></div>

            <!-- Category (required dropdown) -->
            <label for="productCategory">Category *</label>
            <select id="productCategory" required>
                <option value="Lubricants">Lubricants</option>
                <option value="Engine Oil">Engine Oil</option>
                <option value="Transmission Oil">Transmission Oil</option>
                <option value="Brake Fluid">Brake Fluid</option>
                <option value="Coolant">Coolant</option>
                <option value="Parts">Parts</option>
                <option value="Accessories">Accessories</option>
                <option value="Other">Other</option>
            </select>
            <div class="error-message" id="errorCategory"></div>

            <!-- Stock Quantity (required, min 0) -->
            <label for="productStock">Stock Quantity * (Min 0)</label>
            <input type="number" id="productStock" required min="0" value="0">
            <div class="error-message" id="errorStock"></div>

            <!-- Selling Price (required, min 0.01) -->
            <label for="productPrice">Selling Price (SGD) * (Min 0.01)</label>
            <input type="number" id="productPrice" required min="0.01" step="0.01" value="0.00">
            <div class="error-message" id="errorPrice"></div>

            <!-- Image URL (optional) -->
            <label for="productImage">Image URL (optional)</label>
            <input type="text" id="productImage" placeholder="https://...">
            <div class="error-message" id="errorImage"></div>

            <!-- Modal action buttons -->
            <div class="modal-actions">
                <button type="submit" class="save-btn" id="saveBtn">Save</button>
                <button type="button" class="cancel-btn" id="cancelBtn">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- ====================================================================
     DELETE CONFIRMATION MODAL
     ==================================================================== -->
<div class="delete-modal" id="deleteModal">
    <div class="delete-modal-content">
        <h3>‚ö†Ô∏è Confirm Deletion</h3>
        <p>Are you sure you want to delete <strong id="deleteProductName"></strong>?</p>
        <p style="font-size: 14px; color: rgba(255,255,255,0.65); margin-top: -8px;">This action cannot be undone.</p>
        <div class="delete-modal-actions">
            <button class="cancel-btn" id="cancelDeleteBtn">Cancel</button>
            <button class="delete-btn" id="confirmDeleteBtn">Delete Product</button>
        </div>
    </div>
</div>

<!-- ====================================================================
     BIG NOTIFICATION (Success/Error Popup)
     ==================================================================== -->
<div id="bigNotification" class="big-notification"></div>

<script>
/* ====================================================================
   JAVASCRIPT - GLOBAL VARIABLES
   ==================================================================== */

// Data arrays
let allProducts = [];        // All products from database
let filteredProducts = [];   // Products after search/filter
let currentPage = 1;         // Current pagination page
let itemsPerPage = 24;       // Items to show per page
let editingId = null;        // ID of product being edited (null = adding new)
let deleteProductId = null;  // ID of product to delete

/* ====================================================================
   DOM ELEMENT REFERENCES
   ==================================================================== */

// Search, sort, and control elements
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");
const perPageSelect = document.getElementById("perPageSelect");
const productGrid = document.getElementById("productGrid");
const addProductBtn = document.getElementById("addProductBtn");

// Modal elements
const productModal = document.getElementById("productModal");
const productForm = document.getElementById("productForm");
const modalTitle = document.getElementById("modalTitle");
const cancelBtn = document.getElementById("cancelBtn");

// Notification elements
const bigNotification = document.getElementById("bigNotification");
const deleteModal = document.getElementById("deleteModal");
const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

// Pagination elements
const paginationControls = document.getElementById("paginationControls");
const firstPageBtn = document.getElementById("firstPageBtn");
const prevPageBtn = document.getElementById("prevPageBtn");
const nextPageBtn = document.getElementById("nextPageBtn");
const lastPageBtn = document.getElementById("lastPageBtn");
const currentPageDisplay = document.getElementById("currentPageDisplay");
const pageInfo = document.getElementById("pageInfo");

/* ====================================================================
   VALIDATION FUNCTIONS
   ==================================================================== */

/**
 * Validates a single field and displays error message
 * @param {string} fieldId - ID of input field to validate
 * @param {string} errorId - ID of error message element
 * @param {function} validationFn - Function that returns true if valid
 * @param {string} errorMsg - Error message to display
 * @returns {boolean} - True if field is valid
 */
function validateField(fieldId, errorId, validationFn, errorMsg) {
    const field = document.getElementById(fieldId);
    const error = document.getElementById(errorId);
    const isValid = validationFn(field.value);

    if (!isValid) {
        // Show error state
        field.classList.add('error');
        error.textContent = errorMsg;
        error.classList.add('show');
    } else {
        // Remove error state
        field.classList.remove('error');
        error.classList.remove('show');
    }

    return isValid;
}

/**
 * Validates entire form before submission
 * @returns {boolean} - True if all fields are valid
 */
function validateForm() {
    let isValid = true;

    // Validate product name (min 3 characters)
    if (!validateField('productName', 'errorName',
        val => val.trim().length >= 3,
        'Product name must be at least 3 characters')) {
        isValid = false;
    }

    // Validate stock (must be 0 or greater)
    if (!validateField('productStock', 'errorStock',
        val => !isNaN(val) && parseInt(val) >= 0,
        'Stock must be 0 or greater')) {
        isValid = false;
    }

    // Validate price (must be at least 0.01)
    if (!validateField('productPrice', 'errorPrice',
        val => !isNaN(val) && parseFloat(val) >= 0.01,
        'Price must be at least 0.01')) {
        isValid = false;
    }

    // Validate category (must be selected)
    if (!validateField('productCategory', 'errorCategory',
        val => val.trim().length > 0,
        'Category is required')) {
        isValid = false;
    }

    return isValid;
}

/**
 * Clears all validation error states and messages
 */
function clearValidationErrors() {
    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
    document.querySelectorAll('input, select').forEach(el => el.classList.remove('error'));
}

/* ====================================================================
   NOTIFICATION FUNCTIONS
   ==================================================================== */

/**
 * Shows a large animated notification popup
 * @param {string} message - Message to display
 * @param {boolean} isSuccess - True for success (green), false for error (red)
 */
function showBigNotification(message, isSuccess = false) {
    const icon = isSuccess ? '‚úì' : '‚úñ';
    bigNotification.innerHTML = `<span class="notification-icon">${icon}</span>${message}`;
    bigNotification.className = `big-notification ${isSuccess ? 'success' : ''}`;

    // Trigger reflow to restart animation
    void bigNotification.offsetWidth;

    // Show notification
    bigNotification.classList.add('show');

    // Auto-hide after 2.5 seconds
    setTimeout(() => {
        bigNotification.classList.remove('show');
        bigNotification.classList.add('hide');
        setTimeout(() => {
            bigNotification.classList.remove('hide');
            bigNotification.className = 'big-notification';
        }, 400);
    }, 2500);
}

/* ====================================================================
   STATISTICS FUNCTIONS
   ==================================================================== */

/**
 * Updates KPI statistics at top of page
 */
function updateStats() {
    const totalProducts = allProducts.length;
    const totalStock = allProducts.reduce((sum, p) => sum + p.qty, 0);
    const lowStockItems = allProducts.filter(p => p.qty > 60 && p.qty <= 80).length;
    const criticalStockItems = allProducts.filter(p => p.qty <= 60).length;

    document.getElementById('totalProducts').textContent = totalProducts;
    document.getElementById('totalStock').textContent = totalStock.toLocaleString();
    document.getElementById('lowStockItems').textContent = lowStockItems;
    document.getElementById('criticalStockItems').textContent = criticalStockItems;
}

/* ====================================================================
   DATA LOADING FUNCTIONS
   ==================================================================== */

/**
 * Loads all products from the database via API
 */
async function loadProducts() {
    try {
        const response = await fetch('/api/inventory');

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        allProducts = data;
        updateStats();
        filterAndSortProducts();
    } catch (error) {
        console.error('Error loading products:', error);
        productGrid.innerHTML = '<div class="loading" style="color: #ef4444;">Error loading inventory. Please refresh.</div>';
        showBigNotification('FAILED TO LOAD INVENTORY');
    }
}

/* ====================================================================
   FILTER AND SORT FUNCTIONS
   ==================================================================== */

/**
 * Filters and sorts products based on current search and sort settings
 */
function filterAndSortProducts() {
    const searchText = searchInput.value.toLowerCase();
    const sortType = sortSelect.value;

    // Filter products by search text
    filteredProducts = allProducts.filter(p =>
        p.hem_name.toLowerCase().includes(searchText) ||
        (p.sup_part_no && p.sup_part_no.toLowerCase().includes(searchText))
    );

    // Sort products based on selected option
    if (sortType === "name") {
        filteredProducts.sort((a, b) => a.hem_name.localeCompare(b.hem_name));
    } else if (sortType === "stock") {
        filteredProducts.sort((a, b) => b.qty - a.qty);
    } else if (sortType === "price") {
        filteredProducts.sort((a, b) => a.sell_price - b.sell_price);
    }

    // Reset to first page after filter/sort
    currentPage = 1;
    renderProducts();
}

/* ====================================================================
   RENDERING FUNCTIONS
   ==================================================================== */

/**
 * Renders products to the grid with pagination
 */
function renderProducts() {
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageProducts = filteredProducts.slice(startIndex, endIndex);

    // Show/hide pagination controls
    if (filteredProducts.length > itemsPerPage) {
        paginationControls.style.display = 'flex';
        currentPageDisplay.textContent = currentPage;
        pageInfo.textContent = `of ${totalPages} (${filteredProducts.length} items)`;

        // Enable/disable pagination buttons
        firstPageBtn.disabled = currentPage === 1;
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages;
        lastPageBtn.disabled = currentPage === totalPages;
    } else {
        paginationControls.style.display = 'none';
    }

    // Handle empty state
    if (pageProducts.length === 0) {
        productGrid.innerHTML = '<div class="loading">No products found.</div>';
        return;
    }

    // Render product cards
    productGrid.innerHTML = pageProducts.map(product => {
        let stockClass = "";
        let stockLabel = "";

        // Determine stock level status
        if (product.qty <= 60) {
            stockClass = "critical";
            stockLabel = "üî¥ Critical";
        } else if (product.qty <= 80) {
            stockClass = "low";
            stockLabel = "‚ö† Low";
        }

        // Return HTML for product card
        return `
            <div class="card">
                <div class="img-placeholder">${product.image_url ? `<img src="${product.image_url}" style="max-width:100%; max-height:100%; object-fit:contain;">` : 'No Image'}</div>
                <div><strong>${product.hem_name}</strong></div>
                ${product.sup_part_no ? `<small style="color: rgba(255,255,255,0.65);">SKU: ${product.sup_part_no}</small><br>` : ''}
                ${product.category ? `<small style="color: rgba(255,255,255,0.65);">${product.category}</small>` : ''}
                <div class="stock ${stockClass}">Stock: ${product.qty} ${stockLabel}</div>
                <div style="margin-top: 8px; font-size: 14px; font-weight: 900; color: #10b981;">SGD ${parseFloat(product.sell_price).toFixed(2)}</div>
                <div class="card-actions">
                    <button class="edit-btn" onclick="editProduct(${product.inventory_id})">Edit</button>
                    <button class="delete-btn" onclick="showDeleteModal(${product.inventory_id})">Delete</button>
                </div>
            </div>
        `;
    }).join("");
}

/* ====================================================================
   PAGINATION EVENT LISTENERS
   ==================================================================== */

// Jump to first page
firstPageBtn.addEventListener('click', () => {
    currentPage = 1;
    renderProducts();
});

// Previous page
prevPageBtn.addEventListener('click', () => {
    if (currentPage > 1) {
        currentPage--;
        renderProducts();
    }
});

// Next page
nextPageBtn.addEventListener('click', () => {
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    if (currentPage < totalPages) {
        currentPage++;
        renderProducts();
    }
});

// Jump to last page
lastPageBtn.addEventListener('click', () => {
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    currentPage = totalPages;
    renderProducts();
});

// Change items per page
perPageSelect.addEventListener('change', (e) => {
    itemsPerPage = parseInt(e.target.value);
    currentPage = 1; // Reset to first page
    renderProducts();
});

/* ====================================================================
   MODAL FUNCTIONS (Add/Edit Product)
   ==================================================================== */

/**
 * Opens modal for adding a new product
 */
addProductBtn.addEventListener("click", () => {
    editingId = null; // Not editing, adding new
    modalTitle.textContent = "Add Product";
    productForm.reset();
    clearValidationErrors();
    // Set default values
    document.getElementById("productStock").value = "0";
    document.getElementById("productPrice").value = "0.00";
    document.getElementById("productCategory").value = "Lubricants";
    productModal.classList.add("active");
});

/**
 * Opens modal for editing an existing product
 * @param {number} id - Product ID to edit
 */
function editProduct(id) {
    editingId = id;
    const product = allProducts.find(p => p.inventory_id === id);

    modalTitle.textContent = "Edit Product";
    clearValidationErrors();
    
    // Populate form with existing product data
    document.getElementById("productPartNo").value = product.sup_part_no || '';
    document.getElementById("productName").value = product.hem_name;
    document.getElementById("productCategory").value = product.category || 'Lubricants';
    document.getElementById("productStock").value = product.qty;
    document.getElementById("productPrice").value = parseFloat(product.sell_price).toFixed(2);
    document.getElementById("productImage").value = product.image_url || '';

    productModal.classList.add("active");
}

/* ====================================================================
   DELETE MODAL FUNCTIONS
   ==================================================================== */

/**
 * Shows delete confirmation modal
 * @param {number} id - Product ID to delete
 */
function showDeleteModal(id) {
    deleteProductId = id;
    const product = allProducts.find(p => p.inventory_id === id);
    document.getElementById('deleteProductName').textContent = product.hem_name;
    deleteModal.classList.add('active');
}

// Cancel delete operation
cancelDeleteBtn.addEventListener('click', () => {
    deleteModal.classList.remove('active');
    deleteProductId = null;
});

/**
 * Confirms and executes product deletion
 */
confirmDeleteBtn.addEventListener('click', async () => {
    if (!deleteProductId) return;

    deleteModal.classList.remove('active');

    try {
        const response = await fetch(`/api/inventory/${deleteProductId}`, {
            method: 'DELETE'
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (result.success) {
            await loadProducts(); // Reload products after deletion
            showBigNotification('PRODUCT DELETED!', false);
        } else {
            showBigNotification('FAILED TO DELETE: ' + result.message);
        }
    } catch (error) {
        console.error('Error deleting product:', error);
        showBigNotification('FAILED TO DELETE PRODUCT');
    }

    deleteProductId = null;
});

/* ====================================================================
   FORM SUBMISSION (Save Product)
   ==================================================================== */

/**
 * Handles form submission for adding/editing products
 */
productForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Validate form before submission
    if (!validateForm()) {
        showBigNotification('PLEASE FIX ERRORS');
        return;
    }

    // Gather form data
    const partNo = document.getElementById("productPartNo").value.trim();
    const name = document.getElementById("productName").value.trim();
    const category = document.getElementById("productCategory").value;
    const stock = parseInt(document.getElementById("productStock").value);
    const price = parseFloat(document.getElementById("productPrice").value);
    const imageUrl = document.getElementById("productImage").value.trim();

    // Build payload object
    const payload = {
        sup_part_no: partNo,
        hem_name: name,
        category: category,
        qty: stock,
        sell_price: price,
        image_url: imageUrl
    };

    // Disable save button during submission
    const saveBtn = document.getElementById('saveBtn');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Saving...';

    try {
        let response;

        if (editingId) {
            // Update existing product (PUT request)
            response = await fetch(`/api/inventory/${editingId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        } else {
            // Create new product (POST request)
            response = await fetch('/api/inventory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        }

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (result.success) {
            productModal.classList.remove("active");
            await loadProducts(); // Reload products after save
            showBigNotification(editingId ? 'PRODUCT UPDATED!' : 'PRODUCT SAVED!', true);
        } else {
            showBigNotification('FAILED TO SAVE: ' + result.message);
        }
    } catch (error) {
        console.error('Error saving product:', error);
        showBigNotification('FAILED TO SAVE PRODUCT');
    } finally {
        // Re-enable save button
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save';
    }
});

/* ====================================================================
   MODAL CLOSE HANDLERS
   ==================================================================== */

// Close modal when cancel button is clicked
cancelBtn.addEventListener("click", () => {
    productModal.classList.remove("active");
    clearValidationErrors();
});

// Close modal when clicking outside the modal content
productModal.addEventListener("click", (e) => {
    if (e.target === productModal) {
        productModal.classList.remove("active");
        clearValidationErrors();
    }
});

// Close delete modal when clicking outside
deleteModal.addEventListener("click", (e) => {
    if (e.target === deleteModal) {
        deleteModal.classList.remove('active');
        deleteProductId = null;
    }
});

/* ====================================================================
   REAL-TIME VALIDATION (On Input)
   ==================================================================== */

// Validate product name as user types
document.getElementById('productName').addEventListener('input', () => {
    if (document.getElementById('productName').value.trim().length > 0) {
        validateField('productName', 'errorName',
            val => val.trim().length >= 3,
            'Product name must be at least 3 characters');
    }
});

// Validate stock as user types
document.getElementById('productStock').addEventListener('input', () => {
    validateField('productStock', 'errorStock',
        val => !isNaN(val) && parseInt(val) >= 0,
        'Stock must be 0 or greater');
});

// Validate price as user types
document.getElementById('productPrice').addEventListener('input', () => {
    validateField('productPrice', 'errorPrice',
        val => !isNaN(val) && parseFloat(val) >= 0.01,
        'Price must be at least 0.01');
});

/* ====================================================================
   SEARCH AND SORT EVENT LISTENERS
   ==================================================================== */

// Filter products on every keystroke in search
searchInput.addEventListener("keyup", filterAndSortProducts);

// Re-sort products when sort option changes
sortSelect.addEventListener("change", filterAndSortProducts);

/* ====================================================================
   INITIALIZATION
   ==================================================================== */

// Load products when page first loads
loadProducts();
</script>

{% endblock %}