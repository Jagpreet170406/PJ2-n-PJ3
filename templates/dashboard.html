<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sales & Price Optimization Dashboard</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    /* Black and White Theme */
    body {
      background-color: #ffffff !important;
      color: #000000 !important;
    }

    .bw-header {
      border-bottom: 3px solid #000000;
      padding-bottom: 10px;
      font-weight: bold;
    }

    .table-bw {
      border: 2px solid #000000;
    }

    .table-bw thead {
      background-color: #000000 !important;
      color: #ffffff !important;
    }

    .bw-card {
      border: 2px solid #000000;
      border-radius: 0;
      background-color: #ffffff;
    }

    .card {
      border: 2px solid #000000;
      border-radius: 0;
    }

    .card-header {
      background-color: #000000;
      color: #ffffff;
      border-bottom: 2px solid #000000;
    }

    .btn-primary {
      background-color: #000000;
      border-color: #000000;
    }

    .btn-primary:hover {
      background-color: #333333;
      border-color: #333333;
    }

    .btn-success {
      background-color: #000000;
      border-color: #000000;
    }

    .btn-success:hover {
      background-color: #333333;
      border-color: #333333;
    }

    .btn-danger {
      background-color: #666666;
      border-color: #666666;
    }

    .btn-danger:hover {
      background-color: #888888;
      border-color: #888888;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="mb-1 bw-header">Sales & Price Optimization</h1>
  <p class="text-muted">
    AI-style logic suggests recommended prices using past sales, competitor price, stock and demand.
  </p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }} mt-2">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Create form -->
  <div class="card mb-4">
    <div class="card-header">Add Sales Record</div>
    <div class="card-body">
      <form method="post" action="{{ url_for('create') }}">
        <div class="row g-2">
          <div class="col-md-2">
            <label class="form-label">Item Code</label>
            <input name="item_code" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Item Description</label>
            <input name="description" class="form-control">
          </div>
          <div class="col-md-1">
            <label class="form-label">Qty</label>
            <input type="number" min="1" name="qty_sold"
                   class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Sales Value ($)</label>
            <input type="number" step="0.01" min="0.01"
                   name="total_sales" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Period</label>
            <input name="period" class="form-control"
                   placeholder="2025-H1" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Competitor Price</label>
            <input type="number" step="0.01" min="0"
                   name="competitor_price" class="form-control">
          </div>
          <div class="col-md-1 mt-2">
            <label class="form-label">Stock</label>
            <input type="number" min="0" name="stock_qty"
                   class="form-control">
          </div>
          <div class="col-md-1 mt-2">
            <label class="form-label">Demand (1â€“5)</label>
            <input type="number" min="1" max="5"
                   name="demand_level" class="form-control" value="3">
          </div>
        </div>
        <button class="btn btn-primary mt-3" type="submit">Create</button>
      </form>
    </div>
  </div>

  <!-- Stats summary -->
  <div class="row mb-3">
    <div class="col-md-4">
      <div class="card bw-card">
        <div class="card-body">
          <h6 class="card-title mb-1">Total Items</h6>
          <p class="fs-5 mb-0">{{ stats.total_items }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4 mt-2 mt-md-0">
      <div class="card bw-card">
        <div class="card-body">
          <h6 class="card-title mb-1">Total Sales ($)</h6>
          <p class="fs-5 mb-0">{{ "%.2f"|format(stats.total_sales) }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4 mt-2 mt-md-0">
      <div class="card bw-card">
        <div class="card-body">
          <h6 class="card-title mb-1">Average Recommended Price ($)</h6>
          <p class="fs-5 mb-0">{{ "%.2f"|format(stats.avg_recommended) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Listing -->
  <table class="table table-striped table-bordered table-bw">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Item Code</th>
        <th>Item Description</th>
        <th>Qty</th>
        <th>$ Sales Value</th>
        <th>Period</th>
        <th>Competitor</th>
        <th>Stock</th>
        <th>Demand</th>
        <th>Recommended Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% if parts %}
      {% for p in parts %}
      <tr>
        <form method="post" action="{{ url_for('update', id=p[0]) }}">
          <td>{{ p[0] }}</td>
          <td><input class="form-control" name="item_code"
                     value="{{ p[1] }}" required></td>
          <td><input class="form-control" name="description"
                     value="{{ p[2] }}"></td>
          <td><input class="form-control" type="number" min="1"
                     name="qty_sold" value="{{ p[3] }}" required></td>
          <td><input class="form-control" type="number" step="0.01" min="0.01"
                     name="total_sales" value="{{ p[4] }}" required></td>
          <td><input class="form-control" name="period"
                     value="{{ p[5] }}" required></td>
          <td><input class="form-control" type="number" step="0.01" min="0"
                     name="competitor_price" value="{{ p[6] or '' }}"></td>
          <td><input class="form-control" type="number" min="0"
                     name="stock_qty" value="{{ p[7] or 0 }}"></td>
          <td><input class="form-control" type="number" min="1" max="5"
                     name="demand_level" value="{{ p[8] or 3 }}"></td>
          <td>${{ "%.2f"|format(p[9]) }}</td>
          <td class="d-flex gap-1">
            <button class="btn btn-sm btn-success" type="submit">Save</button>
        </form>
            <form method="post" action="{{ url_for('delete', id=p[0]) }}">
              <button class="btn btn-sm btn-danger"
                      onclick="return confirm('Delete this record?');">
                Delete
              </button>
            </form>
          </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="11" class="text-center">No sales records found.</td>
      </tr>
    {% endif %}
    </tbody>
  </table>
</div>
</body>
</html>
    